<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Messenger</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/beercss@3.5.1/dist/cdn/beer.min.css" rel="stylesheet">
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.5.1/dist/cdn/beer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        /* Убираем скролл у body полностью */
        body { font-family: 'Roboto', sans-serif; height: 100vh; margin: 0; overflow: hidden; background: var(--surface); }
        
        .main-row { height: 100vh; }
        
        .drawer { 
            width: 320px; 
            height: 100vh;
            border-radius: 0 32px 32px 0 !important; 
            padding: 16px; 
            border-right: 1px solid var(--outline-variant); 
            display: flex;
            flex-direction: column;
        }

        .main-content { 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
        }

        /* Чат теперь гибкий и не выталкивает футер */
        #messages { 
            flex: 1; 
            background: var(--surface-container-lowest); 
            border-radius: 32px; 
            margin: 0 16px 8px 16px; 
            overflow-y: auto; 
            padding: 20px;
        }

        .user-avatar-container { width: 56px; height: 56px; display: flex; align-items: center; justify-content: center; overflow: hidden; margin-bottom: 8px; }
        .user-avatar { width: 100%; height: 100%; object-fit: cover; }
        
        footer { padding: 8px 16px 16px 16px; }
    </style>
</head>
<body class="light">
    <div class="row no-space main-row">
        <nav class="drawer left active">
            <header class="column padding">
                <div class="circle user-avatar-container primary shadow">
                    {% if avatar %}
                        <img class="user-avatar" src="{{ avatar }}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                    {% endif %}
                    <i class="white-text" style="{% if avatar %}display:none;{% else %}display:flex;{% endif %}">person</i>
                </div>
                <div class="max">
                    <h5 class="no-margin bold">{{ username }}</h5>
                    <p class="small no-margin primary-text">В сети</p>
                </div>
            </header>

            <div class="field prefix round fill margin">
                <i>search</i>
                <input id="search" placeholder="Поиск...">
            </div>

            <div id="friendList" class="scroll max">
                </div>

            <div class="divider"></div>
            <a class="row padding round" href="/logout">
                <i>logout</i>
                <span>Выйти</span>
            </a>
        </nav>

        <main class="max main-content">
            <header class="padding">
                <nav>
                    <h5 id="currentTitle" class="max bold">Выберите чат</h5>
                    <button class="circle transparent" onclick="ui('theme', ui('theme')=='dark'?'light':'dark')">
                        <i>brightness_medium</i>
                    </button>
                </nav>
            </header>

            <div id="messages" class="shadow">
                <div class="center-align middle-align" style="height:100%; opacity:0.4">
                    <i class="extra">chat</i>
                    <p>Выберите, кому написать</p>
                </div>
            </div>

            <footer>
                <div class="field middle-align no-margin round fill">
                    <input id="msg" class="max" placeholder="Напишите сообщение...">
                    <button id="send" class="circle primary">
                        <i>send</i>
                    </button>
                </div>
            </footer>
        </main>
    </div>
</body>
</html>